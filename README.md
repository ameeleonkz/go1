# Банковский REST API сервис

REST API для банковского сервиса, реализованный на Go.

## Функциональность

- Регистрация и аутентификация пользователей
- Управление банковскими счетами
- Операции с картами (генерация, просмотр, деактивация)
- Переводы между счетами
- Кредитные операции с графиком платежей
- Интеграция с ЦБ РФ для получения ключевой ставки
- Отправка email-уведомлений

## Технологии

- Go 1.23+
- PostgreSQL 17
- JWT для аутентификации
- Gorilla Mux для маршрутизации
- Logrus для логирования
- PGP для шифрования данных карт
- SMTP для отправки email
- Godotenv для управления конфигурацией

## Структура проекта

```
.
├── cmd/
│   └── api/              # Точка входа приложения
├── internal/
│   ├── models/          # Модели данных
│   ├── repository/      # Репозитории для работы с БД
│   ├── service/         # Бизнес-логика
│   ├── handler/         # HTTP-обработчики
│   └── middleware/      # Middleware компоненты
├── pkg/
│   ├── centralbank/     # Интеграция с ЦБ РФ
│   └── email/          # Отправка email
├── migrations/         # SQL-миграции
└── .env               # Конфигурационный файл
```

## Установка и запуск

1. Установите зависимости:
```bash
go mod download
```

2. Создайте базу данных PostgreSQL и примените миграции:
```bash
psql -U <user> -d <db> -f migrations/001_initial_schema.sql
```

3. Создайте файл `.env` в корне проекта c содержимым из .env.example

4. Запустите сервер:
```bash
go run cmd/api/main.go
```

## API Endpoints
(подробное описание эндпоинтов см. в файле [API.md](API.md))

### Публичные эндпоинты

- `POST /register` - Регистрация пользователя
- `POST /login` - Аутентификация

### Защищенные эндпоинты

#### Пользователи
- `GET /profile` - Получение профиля

#### Счета
- `POST /accounts` - Создание счета
- `GET /accounts` - Получение списка счетов
- `GET /accounts/{id}` - Получение счета по ID
- `POST /transfer` - Перевод средств
- `GET /transactions` - История транзакций

#### Карты
- `POST /cards` - Создание карты
- `GET /cards/{id}` - Получение карты по ID
- `GET /cards` - Получение списка карт
- `POST /cards/{id}/deactivate` - Деактивация карты

#### Кредиты
- `POST /credits` - Оформление кредита
(используется интеграция с ЦБ РФ для получения актуальной ключевой ставки.
Ставка по кредиту == ключевая ставка + 5% маржи
Все запросы к API ЦБ РФ делаются через SOAP-протокол)
- `GET /credits/{id}` - Получение кредита по ID
- `GET /credits` - Получение списка кредитов
- `GET /credits/{id}/schedule` - График платежей
- `POST /credits/{id}/payments/{payment_id}` - Обработка платежа

#### Аналитика
- `GET /analytics?forecast_days=<days>` - получить аналитику по платежам

## Безопасность

- JWT-аутентификация
- Шифрование данных карт (PGP)
- Хеширование паролей (bcrypt)
- HMAC для проверки целостности данных
- Защита от SQL-инъекций
- Валидация входных данных
